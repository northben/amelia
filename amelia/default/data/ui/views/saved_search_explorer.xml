<form>
  <label>Saved Search Explorer</label>
  <search id="base">
    <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$
| `remove_unnecessary_fields`
| `create_mv_search_field`
| search $app$ $search_attributes_string$ $search_field$</query>
  </search>
  <fieldset submitButton="false">
    <input type="dropdown" searchWhenChanged="true" token="splunk_server">
      <label>Search head instance</label>
      <showClearButton>false</showClearButton>
      <populatingSearch fieldForLabel="serverName" fieldForValue="serverName">| `dmc_get_instance_info(dmc_group_search_head)`</populatingSearch>
      <selectFirstChoice>true</selectFirstChoice>
      <change>
        <condition value="*">
          <set token="host">$row.host$</set>
        </condition>
      </change>
    </input>
    <input type="multiselect" token="app">
      <label>App</label>
      <valuePrefix>eai:acl.app="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <fieldForLabel>eai:acl.app</fieldForLabel>
      <fieldForValue>eai:acl.app</fieldForValue>
      <search>
        <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$ | search $search_attributes_string$
| stats count by eai:acl.app</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">All apps</choice>
      <initialValue>*</initialValue>
    </input>
    <input type="multiselect" token="search_attributes">
      <label>Attributes</label>
      <delimiter> </delimiter>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>query</fieldForValue>
      <search>
        <query>| inputlookup amelia_saved_search_attributes.csv</query>
      </search>
      <initialValue>auto_summarize=1,action.summary_index=1,dispatch.earliest_time=rt*</initialValue>
      <change>
        <eval token="search_attributes_bool">mvjoin(split($search_attributes$," ")," ".bool." ")</eval>
        <eval token="search_attributes_string">include." (".search_attributes_bool.")"</eval>
      </change>
    </input>
    <input type="radio" token="include_tok">
      <label>Include these attributes?</label>
      <choice value="include_any">Include any</choice>
      <choice value="exclude_any">Exclude any</choice>
      <choice value="include_all">Include all</choice>
      <choice value="exclude_all">Exclude all</choice>
      <default>include_any</default>
      <change>
        <condition value="include_any">
          <set token="bool">OR</set>
          <set token="include"></set>
          <eval token="search_attributes_bool">mvjoin(split($search_attributes$," ")," ".bool." ")</eval>
          <eval token="search_attributes_string">include." (".search_attributes_bool.")"</eval>
        </condition>
        <condition value="exclude_any">
          <set token="bool">OR</set>
          <set token="include">NOT</set>
          <eval token="search_attributes_bool">mvjoin(split($search_attributes$," ")," ".bool." ")</eval>
          <eval token="search_attributes_string">include." (".search_attributes_bool.")"</eval>
        </condition>
        <condition value="include_all">
          <set token="bool">AND</set>
          <set token="include"></set>
          <eval token="search_attributes_bool">mvjoin(split($search_attributes$," ")," ".bool." ")</eval>
          <eval token="search_attributes_string">include." (".search_attributes_bool.")"</eval>
        </condition>
        <condition value="exclude_all">
          <set token="bool">AND</set>
          <set token="include">NOT</set>
          <eval token="search_attributes_bool">mvjoin(split($search_attributes$," ")," ".bool." ")</eval>
          <eval token="search_attributes_string">include." (".search_attributes_bool.")"</eval>
        </condition>
      </change>
    </input>
    <input type="multiselect" token="fieldz">
      <label>Fields</label>
      <default>eai:acl.app,title,search</default>
      <prefix>fields </prefix>
      <delimiter> </delimiter>
      <fieldForLabel>column</fieldForLabel>
      <fieldForValue>column</fieldForValue>
      <search>
        <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$
| head 1 | fields - display.* action.*
| transpose</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="text" token="search_field">
      <label>Search</label>
      <prefix>search_field="*</prefix>
      <suffix>*"</suffix>
      <default>*</default>
    </input>
    <html>
      <a href="/app/lookup_editor/lookup_edit?lookup=amelia_saved_search_attributes.csv&amp;namespace=amelia&type=csv&owner=nobody" target="_blank">Amelia Saved Search Attributes Lookup</a>
</html>
  </fieldset>
  <row>
    <panel>
      <html>Showing searches that $search_attributes_string$</html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Count of searches by app and attributes</title>
        <search base="base">
          <query>| foreach *
    [ eval all_fields=mvappend(all_fields,"&lt;&lt;FIELD&gt;&gt;=".'&lt;&lt;FIELD&gt;&gt;') ]
| lookup saved_search_attributes query as all_fields | search $search_attributes_string$ | chart count by eai:acl.app label
| addcoltotals labelfield=eai:acl.app</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Searches</title>
        <search base="base">
          <query>| $fieldz$</query>
        </search>
        <option name="count">1</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>To run a curl command, create ~/.netrc with<br/>
        <pre>machine 127.0.0.1
login admin
password changeme</pre>
or change curl's "-n" to "-u my_username" to be prompted to authenticate to Spunk as "my_username" each time.
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <input type="radio" token="is_scheduled">
        <label>Scheduled</label>
        <choice value="">no change</choice>
        <choice value="-d is_scheduled=0">0</choice>
        <choice value="-d is_scheduled=1">1</choice>
        <default>no change</default>
      </input>
      <input type="radio" token="auto_summarize">
        <label>Accelerated</label>
        <choice value="">no change</choice>
        <choice value="-d auto_summarize=0">0</choice>
        <choice value="-d auto_summarize=1">1</choice>
        <default>no change</default>
      </input>
      <input type="text" token="dispatch_earliest_time">
        <label>dispatch.earliest_time</label>
        <prefix>-d dispatch.earliest_time=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="dispatch_latest_time">
        <label>dispatch.latest_time</label>
        <prefix>-d dispatch.latest_time=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="cron_schedule">
        <label>cron_schedule</label>
        <prefix>-d cron_schedule=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="schedule_window">
        <label>schedule_window</label>
        <prefix>-d schedule_window=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <table>
        <title>Command generator</title>
        <search base="base">
          <query>| eval command="curl -n -k $is_scheduled$ $auto_summarize$ $dispatch_earliest_time$ $dispatch_latest_time$ $cron_schedule$ $schedule_window$ " + id
| table command</query>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
