<form>
  <label>Saved Search Explorer</label>
  <search id="base">
    <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$
| $fieldz$ id disabled eai:acl.app is_scheduled dispatch.earliest_time auto_summarize realtime_schedule action.summary_index
| eval search_field=""
| foreach *
    [ eval search_field=search_field + " " + coalesce('&lt;&lt;FIELD&gt;&gt;',"")]
| search $app$ $include$ ($search_attributes$) $search_field$</query>
  </search>
  <fieldset submitButton="false">
      <input type="dropdown" searchWhenChanged="true" token="splunk_server">
      <label>Search head instance</label>
      <showClearButton>false</showClearButton>
      <populatingSearch fieldForLabel="serverName" fieldForValue="serverName">| `dmc_get_instance_info(dmc_group_search_head)`
      </populatingSearch>
      <selectFirstChoice>true</selectFirstChoice>
      <change>
        <condition value="*">
          <set token="host">$row.host$</set>
        </condition>
      </change>
    </input>
    <input type="multiselect" token="app">
      <label>App</label>
      <valuePrefix>eai:acl.app="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>eai:acl.app</fieldForValue>
      <search>
        <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$ | search $search_attributes$
| stats count by eai:acl.app
| eval label='eai:acl.app'." (".count.")"</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">All apps</choice>
      <default>*</default>
    </input>
    <input type="multiselect" token="search_attributes">
      <label>Attributes</label>
      <default>disabled=0</default>
      <delimiter> OR </delimiter>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>query</fieldForValue>
      <search>
        <query>| inputlookup amelia_saved_search_attributes.csv</query>
      </search>
    </input>
    <input type="radio" token="include">
      <label>Include these attributes?</label>
      <choice value="">Include</choice>
      <choice value="NOT">Exclude</choice>
      <default></default>
    </input>
    <input type="multiselect" token="fieldz">
      <label>Fields</label>
      <default>eai:acl.app,title,search</default>
      <prefix>fields </prefix>
      <delimiter> </delimiter>
      <fieldForLabel>column</fieldForLabel>
      <fieldForValue>column</fieldForValue>
      <search>
        <query>| rest /servicesNS/-/-/saved/searches splunk_server=$splunk_server$
| head 1 | fields - display.* action.*
| transpose</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="text" token="search_field">
      <label>Search</label>
      <prefix>search_field="*</prefix>
      <suffix>*"</suffix>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>Showing searches that $include$ match $search_attributes$</html>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Scheduled</title>
        <search base="base">
          <query>| stats count(eval(is_scheduled=1)) as is_scheduled</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Accelerated</title>
        <search base="base">
          <query>| stats count(eval(auto_summarize=1)) as auto_summarize</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Real Time Dispatch</title>
        <search base="base">
          <query>| stats count(eval(match('dispatch.earliest_time',"rt.*"))) as rt</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Continuous Scheduling</title>
        <search base="base">
          <query>| stats count(eval(match('realtime_schedule',"0"))) as rs</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Summary Indexing</title>
        <search base="base">
          <query>| stats count(eval(match('action.summary_index',"1"))) as si</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Searches</title>
        <search base="base">
          <query>| $fieldz$</query>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>To run a curl command, create ~/.netrc with<br/>
        <pre>machine 127.0.0.1
login admin
password changeme</pre>
or change curl's "-n" to "-u my_username" to be prompted to authenticate to Spunk as "my_username" each time.
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <input type="radio" token="is_scheduled">
        <label>Scheduled</label>
        <choice value="">no change</choice>
        <choice value="-d is_scheduled=0">0</choice>
        <choice value="-d is_scheduled=1">1</choice>
        <default>no change</default>
      </input>
      <input type="radio" token="auto_summarize">
        <label>Accelerated</label>
        <choice value="">no change</choice>
        <choice value="-d auto_summarize=0">0</choice>
        <choice value="-d auto_summarize=1">1</choice>
        <default>no change</default>
      </input>
      <input type="text" token="dispatch_earliest_time">
        <label>dispatch.earliest_time</label>
        <prefix>-d dispatch.earliest_time=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="dispatch_latest_time">
        <label>dispatch.latest_time</label>
        <prefix>-d dispatch.latest_time=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="cron_schedule">
        <label>cron_schedule</label>
        <prefix>-d cron_schedule=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <input type="text" token="schedule_window">
        <label>schedule_window</label>
        <prefix>-d schedule_window=\"</prefix>
        <suffix>\"</suffix>
        <default></default>
      </input>
      <table>
        <title>Command generator</title>
        <search base="base">
          <query>| eval command="curl -n -k $is_scheduled$ $auto_summarize$ $dispatch_earliest_time$ $dispatch_latest_time$ $cron_schedule$ $schedule_window$ " + id
| table command</query>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>